import{a as S,m as N,n as z,d as k,p as E,r as $,q as H,s as j,v as J,j as B,e as d,f as e,t as u,k as w,F as b,h as g,w as D,x as L,g as R,o as r,y as P,z as V,i as O,_ as q,A as M,B as W,C as X,S as Y,l as Z,D as x,E as ee,G,H as a,I as A,J as te,K as oe,L as se,M as ne}from"./index-896a6a3c.js";import{u as ae}from"./useGetArticle-7ebd40d4.js";import{u as le,a as ie}from"./useDeleteFollow-4ee58937.js";function re(t,o){return S({mutationFn:()=>N.deleteBySlug(o.value),onSettled:()=>{t.invalidateQueries(z.lists.all)}})}const v=t=>(P("data-v-07b80dc8"),t=t(),V(),t),ce={class:"article-meta"},ue=["href"],me=["src"],de={class:"info"},_e=["href"],fe={class:"date"},he=v(()=>e("i",{class:"ion-edit"},null,-1)),pe=v(()=>e("span",null," Edit Article",-1)),ge=v(()=>e("i",{class:"ion-trash-a"},null,-1)),ve=v(()=>e("span",null," Delete Article",-1)),ye=[ge,ve],Ce=v(()=>e("i",{class:"ion-plus-round"},null,-1)),Ie=v(()=>e("i",{class:"ion-heart"},null,-1)),$e=k({__name:"ArticleMetadata",props:{articleInfo:{},isMyArticle:{type:Boolean},isLoggedIn:{type:Boolean}},setup(t){const{articleInfo:o,isMyArticle:c,isLoggedIn:n}=t,s=E(),_=$(o.slug),l=H(o.author,"username"),{mutate:C}=j(s,_),{mutate:I}=J(s,_),{mutate:p}=le(s,l),{mutate:f}=ie(s,l),{mutate:h}=re(s,_);function m(){o.favorited?I():C()}function Q(){o.author.following?f():p()}function U(){confirm("Are you sure to delete this article?")&&(h(),O.push("/"))}return(i,ot)=>{const K=B("RouterLink");return r(),d("div",ce,[e("a",{href:`/profile/${i.articleInfo.author.username}`},[e("img",{src:i.articleInfo.author.image},null,8,me)],8,ue),e("div",de,[e("a",{href:`/profile/${i.articleInfo.author.username}`,class:"author"},u(i.articleInfo.author.username),9,_e),e("span",fe,u(new Date(i.articleInfo.createdAt).toDateString()),1)]),w("    "),i.isMyArticle?(r(),d(b,{key:0},[g(K,{to:`/editor/${i.articleInfo.slug}`,class:"btn btn-sm btn-outline-secondary"},{default:D(()=>[he,pe]),_:1},8,["to"]),e("button",{class:"btn btn-sm btn-outline-danger",onClick:U},ye)],64)):i.isLoggedIn?(r(),d(b,{key:1},[e("button",{class:L(["btn btn-sm btn-outline-secondary",{following:i.articleInfo.author.following}]),onClick:Q},[Ce,e("span",null," Follow "+u(i.articleInfo.author.username),1)],2),e("button",{class:L(["btn btn-sm btn-outline-primary",{favorite:i.articleInfo.favorited}]),onClick:m},[Ie,e("span",null," Favorite Post ("+u(i.articleInfo.favoritesCount)+")",1)],2)],64)):R("",!0)])}}});const T=q($e,[["__scopeId","data-v-07b80dc8"]]);function be(t){return M({url:`/articles/${t}/comments`,method:"GET"}).then(o=>o.comments)}function ke(t,o){return M({url:`/articles/${t}/comments`,method:"POST",body:{comment:{body:o}}})}function we(t,o){return M({url:`/articles/${t}/comments/${o}`,method:"DELETE"})}const F={get:be,post:ke,deleteById:we},y={lists:{all:["comments"],article:t=>[...y.lists.all,t]},comment:{only:["comment"],id:t=>[...y.comment.only,t]}};function De(t){return W({queryKey:y.lists.article(t),queryFn:()=>F.get(t.value),cacheTime:X,staleTime:Y})}function Ae(t,o){return S({mutationFn:c=>F.post(o.value,c),onSettled:()=>{t.invalidateQueries(y.lists.article(o))}})}function Se(t,o){return S({mutationFn:c=>F.deleteById(o.value,c),onSettled:()=>{t.invalidateQueries(y.lists.article(o))}})}const Me=t=>(P("data-v-50f7ffde"),t=t(),V(),t),Fe={class:"card"},Le={class:"card-block"},Te={class:"card-text"},Ee={class:"card-footer"},Be=["src"],Re={class:"date-posted"},Pe=Me(()=>e("i",{class:"ion-trash-a"},null,-1)),Ve=[Pe],qe=k({__name:"CommentComponent",props:{commentInfo:{}},emits:["delete-comment"],setup(t,{emit:o}){const{commentInfo:c}=t;function n(){o("delete-comment",c.id)}return(s,_)=>{const l=B("RouterLink");return r(),d("div",Fe,[e("div",Le,[e("p",Te,u(s.commentInfo.body),1)]),e("div",Ee,[g(l,{to:`/profile/${s.commentInfo.author.username}`,class:"comment-author"},{default:D(()=>[e("img",{src:s.commentInfo.author.image,class:"comment-author-img"},null,8,Be)]),_:1},8,["to"]),w("   "),g(l,{to:`/profile/${s.commentInfo.author.username}`,class:"comment-author"},{default:D(()=>[w(u(s.commentInfo.author.username),1)]),_:1},8,["to"]),e("span",Re,u(new Date(s.commentInfo.createdAt).toDateString()),1),e("button",{class:"mod-options delete-button",onClick:n},Ve)])])}}});const Ge=q(qe,[["__scopeId","data-v-50f7ffde"]]),Qe={class:"row"},Ue={class:"col-xs-12 col-md-8 offset-md-2"},Ke=["onSubmit"],Ne={class:"card-block"},ze={class:"card-footer"},He=["src"],je=e("button",{class:"btn btn-sm btn-primary",type:"submit"},"Post Comment",-1),Je=k({__name:"CommentSection",props:{slug:{},currentUserImage:{}},setup(t){const{slug:o}=t,c=E(),n=$(""),s=$(o),{mutate:_}=Ae(c,s),{mutate:l}=Se(c,s),{data:C}=De(s);function I(){_(n.value),n.value=""}function p(f){confirm("Are you sure to delete this comment?")&&l(f)}return(f,h)=>(r(),d("div",Qe,[e("div",Ue,[e("form",{class:"card comment-form",onSubmit:Z(I,["prevent"])},[e("div",Ne,[x(e("textarea",{class:"form-control",placeholder:"Write a comment...",rows:"3","onUpdate:modelValue":h[0]||(h[0]=m=>n.value=m)},null,512),[[ee,n.value]])]),e("div",ze,[e("img",{src:f.currentUserImage,class:"comment-author-img"},null,8,He),je])],40,Ke),(r(!0),d(b,null,G(a(C),m=>(r(),A(Ge,{key:m.id,"comment-info":m,onDeleteComment:p},null,8,["comment-info"]))),128))])]))}}),Oe={key:2,class:"article-page"},We={class:"banner"},Xe={class:"container"},Ye={class:"container page"},Ze={class:"row article-content"},xe={class:"col-md-12"},et={class:"tag-list"},tt=e("hr",null,null,-1),lt=k({__name:"ArticleView",setup(t){const o=te(),c=$(o.params.slug),{data:n,isLoading:s,isError:_}=ae(c),{data:l}=oe();return(C,I)=>{var p,f,h;return a(s)?(r(),A(se,{key:0})):a(_)?(r(),A(ne,{key:1})):a(n)?(r(),d("div",Oe,[e("div",We,[e("div",Xe,[e("h1",null,u(a(n).title),1),g(T,{"article-info":a(n),"is-my-article":a(n).author.username===((p=a(l))==null?void 0:p.username),"is-logged-in":!!a(l)},null,8,["article-info","is-my-article","is-logged-in"])])]),e("div",Ye,[e("div",Ze,[e("div",xe,[e("p",null,u(a(n).body),1),e("ul",et,[(r(!0),d(b,null,G(a(n).tagList,m=>(r(),d("li",{key:m,class:"tag-default tag-pill tag-outline"},u(m),1))),128))])])]),tt,g(T,{"article-info":a(n),"is-my-article":a(n).author.username===((f=a(l))==null?void 0:f.username),"is-logged-in":!!a(l)},null,8,["article-info","is-my-article","is-logged-in"]),g(Je,{slug:a(n).slug,"current-user-image":(h=a(l))==null?void 0:h.image},null,8,["slug","current-user-image"])])])):R("",!0)}}});export{lt as default};
